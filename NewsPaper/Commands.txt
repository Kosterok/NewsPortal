from django.contrib.auth.models import User
from news.models import Author, Category, Post, PostCategory, Comment

u1 = User.objects.create_user('Иванов Иван')
u2 = User.objects.create_user('Петров Пётр')

a1 = Author.objects.create(user=u1)
a2 = Author.objects.create(user=u2)

c_sport = Category.objects.create(name='Спорт')
c_polit = Category.objects.create(name='Политика')
c_edu   = Category.objects.create(name='Образование')
c_it    = Category.objects.create(name='IT')

p1 = Post.objects.create(author=a1, post_type=Post.POST, title='Статья 1', text='Текст статьи 1')
p2 = Post.objects.create(author=a1, post_type=Post.POST, title='Статья 2', text='Текст статьи 2. Большая статья, где много текста, чтобы проверить как работает превью текста (отображение не всей статьи, а только её части). Кроме самого превью должно отображаться многоточие в конце "обрезанного" текста')
n1 = Post.objects.create(author=a2, post_type=Post.NEWS, title='Новость 1', text='Текст новости 1')

p1.categories.add(c_sport)
p2.categories.add(c_it, c_edu)
n1.categories.add(c_polit)

cm1 = Comment.objects.create(post=p1, user=u2, text='Отличная статья!')
cm2 = Comment.objects.create(post=p2, user=u1, text='Гуд')
cm3 = Comment.objects.create(post=p2, user=u2, text='Полезно')
cm4 = Comment.objects.create(post=n1, user=u1, text='Интересно')

p1.like(); p1.like(); p1.dislike()
p2.like(); p2.like(); p2.like()
n1.dislike()

cm1.like(); cm1.like()
cm2.dislike()
cm3.like()
cm4.like(); cm4.dislike(); cm4.dislike()

a1.update_rating()
a2.update_rating()

best_author = Author.objects.order_by('-rating').values('user__username', 'rating').first()
best_author

best_post = Post.objects.order_by('-rating').select_related('author__user').first()
best_post.created_at
best_post.author.user.username
best_post.rating
best_post.title
best_post.preview()

Comment.objects.filter(post=best_post).values('created_at', 'user__username', 'rating', 'text')